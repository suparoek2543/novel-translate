<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Novel Reader</title>
    <style>
        :root {
            --bg-color: #f4f4f9;
            --text-color: #333;
            --sidebar-bg: #fff;
            --accent-color: #6c5ce7;
        }
        [data-theme="dark"] {
            --bg-color: #1e1e1e;
            --text-color: #e0e0e0;
            --sidebar-bg: #2d2d2d;
            --accent-color: #a29bfe;
        }
        body { margin: 0; font-family: 'Sarabun', sans-serif; background: var(--bg-color); color: var(--text-color); display: flex; height: 100vh; overflow: hidden; transition: 0.3s; }
        
        /* Sidebar (‡∏™‡∏≤‡∏£‡∏ö‡∏±‡∏ç) */
        #sidebar { width: 300px; background: var(--sidebar-bg); border-right: 1px solid #ccc; display: flex; flex-direction: column; }
        .sidebar-header { padding: 20px; font-weight: bold; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        #chapter-list { flex: 1; overflow-y: auto; padding: 0; margin: 0; list-style: none; }
        .chapter-item { padding: 15px 20px; cursor: pointer; border-bottom: 1px solid #f0f0f0; transition: 0.2s; }
        .chapter-item:hover, .chapter-item.active { background: var(--accent-color); color: white; }
        
        /* Main Content (‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤) */
        #main { flex: 1; padding: 40px; overflow-y: auto; max-width: 900px; margin: 0 auto; line-height: 1.8; font-size: 18px; }
        h1 { color: var(--accent-color); }
        .content-body { white-space: pre-wrap; margin-bottom: 50px; }
        .nav-btns { display: flex; justify-content: space-between; margin-top: 30px; }
        button { padding: 10px 20px; border: none; background: var(--accent-color); color: white; cursor: pointer; border-radius: 5px; }
        button:disabled { background: #ccc; cursor: not-allowed; }

        /* Toggle Button */
        .theme-toggle { cursor: pointer; background: none; border: 1px solid var(--text-color); color: var(--text-color); padding: 5px 10px; border-radius: 15px; font-size: 12px; }

        @media (max-width: 768px) {
            body { flex-direction: column; }
            #sidebar { width: 100%; height: 200px; }
            #main { padding: 20px; }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>

    <div id="sidebar">
        <div class="sidebar-header">
            üìö ‡∏™‡∏≤‡∏£‡∏ö‡∏±‡∏ç
            <button class="theme-toggle" onclick="toggleTheme()">üåì Theme</button>
        </div>
        <ul id="chapter-list">
            </ul>
    </div>

    <div id="main">
        <div id="reader-content">
            <h1>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö</h1>
            <p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡πà‡∏≤‡∏ô...</p>
        </div>
        <div class="nav-btns" id="nav-btns" style="display:none">
            <button onclick="prevChapter()">PREV</button>
            <button onclick="nextChapter()">NEXT</button>
        </div>
    </div>

    <script>
        let chapters = [];
        let currentindex = -1;

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå JSON
        fetch('novels.json')
            .then(response => response.json())
            .then(data => {
                // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≠‡∏ô‡∏ï‡∏≤‡∏° ID (‡∏à‡∏≤‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÑ‡∏õ‡∏°‡∏≤‡∏Å)
                chapters = data.sort((a, b) => parseInt(a.ep_id) - parseInt(b.ep_id));
                renderSidebar();
                
                // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ï‡∏≠‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏•‡∏¢
                const lastRead = localStorage.getItem('lastReadEp');
                if (lastRead) {
                    const idx = chapters.findIndex(c => c.ep_id == lastRead);
                    if (idx !== -1) loadChapter(idx);
                }
            })
            .catch(err => console.error("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå novels.json ‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ", err));

        function renderSidebar() {
            const list = document.getElementById('chapter-list');
            list.innerHTML = '';
            chapters.forEach((ep, index) => {
                const li = document.createElement('li');
                li.className = 'chapter-item';
                li.innerText = `‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà ${index + 1}: ${ep.title}`;
                li.onclick = () => loadChapter(index);
                list.appendChild(li);
            });
        }

        function loadChapter(index) {
            currentindex = index;
            const ep = chapters[index];
            
            // Render ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤
            const contentDiv = document.getElementById('reader-content');
            contentDiv.innerHTML = `
                <h1>${ep.title}</h1>
                <div class="content-body">${ep.content}</div>
                <hr>
                <div style="font-size: 14px; color: gray;">Original: <a href="${ep.link}" target="_blank">Link</a></div>
            `;

            // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏∏‡πà‡∏°
            document.getElementById('nav-btns').style.display = 'flex';
            
            // Update Sidebar Active State
            document.querySelectorAll('.chapter-item').forEach((el, i) => {
                el.classList.toggle('active', i === index);
            });

            // Scroll ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏ô‡∏™‡∏∏‡∏î
            document.getElementById('main').scrollTop = 0;
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
            localStorage.setItem('lastReadEp', ep.ep_id);
        }

        function nextChapter() {
            if (currentindex < chapters.length - 1) loadChapter(currentindex + 1);
        }

        function prevChapter() {
            if (currentindex > 0) loadChapter(currentindex - 1);
        }

        function toggleTheme() {
            const body = document.body;
            const isDark = body.getAttribute('data-theme') === 'dark';
            body.setAttribute('data-theme', isDark ? 'light' : 'dark');
        }
    </script>
</body>
</html>
