<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Novel Reader</title>
    <style>
        :root {
            --bg-color: #f4f4f9;
            --text-color: #333;
            --sidebar-bg: #fff;
            --accent-color: #6c5ce7;
            --hover-color: #f0f0f0;
            --border-color: #ccc;
        }
        [data-theme="dark"] {
            --bg-color: #1e1e1e;
            --text-color: #e0e0e0;
            --sidebar-bg: #2d2d2d;
            --accent-color: #a29bfe;
            --hover-color: #3d3d3d;
            --border-color: #444;
        }
        body { margin: 0; font-family: 'Sarabun', sans-serif; background: var(--bg-color); color: var(--text-color); display: flex; height: 100vh; overflow: hidden; transition: 0.3s; }
        
        /* --- Sidebar (‡∏™‡∏≤‡∏£‡∏ö‡∏±‡∏ç) --- */
        #sidebar { 
            width: 320px; 
            background: var(--sidebar-bg); 
            border-right: 1px solid var(--border-color); 
            display: flex; 
            flex-direction: column; 
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        .sidebar-header { 
            padding: 15px; 
            font-weight: bold; 
            border-bottom: 1px solid var(--border-color); 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        #novel-list { flex: 1; overflow-y: auto; padding: 10px; }
        
        /* Accordion Style */
        details { margin-bottom: 5px; }
        summary { 
            cursor: pointer; padding: 12px; font-weight: bold; list-style: none; 
            border-radius: 5px; transition: 0.2s; display: flex; align-items: center;
        }
        summary:hover { background: var(--hover-color); }
        summary::before { content: 'üìÅ'; margin-right: 10px; }
        details[open] summary::before { content: 'üìÇ'; }
        
        .chapter-item { 
            padding: 10px 10px 10px 35px; cursor: pointer; font-size: 14px; 
            border-bottom: 1px solid rgba(0,0,0,0.05); 
        }
        .chapter-item:hover { background: var(--hover-color); color: var(--accent-color); }
        .chapter-item.active { background: var(--accent-color); color: white; }
        
        /* --- Main Content (‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡πà‡∏≤‡∏ô) --- */
        #main { 
            flex: 1; 
            padding: 40px; 
            overflow-y: auto; 
            max-width: 900px; 
            margin: 0 auto; 
            line-height: 1.8; 
            font-size: 18px; 
            position: relative;
        }
        h1 { color: var(--accent-color); border-bottom: 2px solid var(--accent-color); padding-bottom: 10px; }
        .content-body { white-space: pre-wrap; margin-bottom: 50px; }
        
        /* ‡∏õ‡∏∏‡πà‡∏°‡∏ï‡πà‡∏≤‡∏á‡πÜ */
        .nav-btns { display: flex; justify-content: space-between; margin-top: 30px; padding-bottom: 50px; }
        button { padding: 10px 20px; border: none; background: var(--accent-color); color: white; cursor: pointer; border-radius: 5px; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .theme-toggle { background: none; border: 1px solid var(--text-color); color: var(--text-color); padding: 5px 10px; border-radius: 15px; font-size: 12px; }

        /* --- Mobile Specific UI --- */
        .menu-btn { 
            display: none; /* ‡∏ã‡πà‡∏≠‡∏ô‡πÉ‡∏ô PC */
            position: fixed; top: 15px; left: 15px; z-index: 900;
            background: var(--accent-color); color: white; 
            border-radius: 50%; width: 45px; height: 45px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            font-size: 20px; text-align: center; line-height: 45px; cursor: pointer;
        }
        .close-sidebar-btn { display: none; background: none; border: none; font-size: 24px; color: var(--text-color); cursor: pointer; }
        
        /* Overlay (‡∏â‡∏≤‡∏Å‡∏´‡∏•‡∏±‡∏á‡∏°‡∏∑‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠) */
        #overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 999;
        }

        /* üì± Mobile Styles */
        @media (max-width: 768px) {
            body { flex-direction: row; } /* ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô row ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ sidebar ‡∏ã‡πâ‡∏≠‡∏ô‡∏ó‡∏±‡∏ö‡πÑ‡∏î‡πâ */
            
            #sidebar {
                position: fixed; top: 0; left: -100%; /* ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏õ‡∏ó‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢ */
                width: 85%; height: 100%; 
                box-shadow: 2px 0 10px rgba(0,0,0,0.2);
            }
            #sidebar.active { transform: translateX(100%); left: -85%; } /* ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å‡∏°‡∏≤ */
            /* ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Logic Sidebar Slide: */
            #sidebar { left: -320px; width: 320px; }
            #sidebar.show { transform: translateX(320px); }

            #main { 
                width: 100%; 
                padding: 70px 20px 20px 20px; /* ‡πÄ‡∏ß‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π */
            }
            
            .menu-btn { display: block; } /* ‡πÇ‡∏ä‡∏ß‡πå‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π */
            .close-sidebar-btn { display: block; } /* ‡πÇ‡∏ä‡∏ß‡πå‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏¥‡∏î */
            
            /* ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
            #main { font-size: 16px; line-height: 1.6; }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>

    <div id="overlay" onclick="toggleSidebar()"></div>

    <div class="menu-btn" onclick="toggleSidebar()">‚ò∞</div>

    <div id="sidebar">
        <div class="sidebar-header">
            <span>üìö ‡∏Ñ‡∏•‡∏±‡∏á‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢</span>
            <div style="display:flex; gap:10px; align-items:center;">
                <button class="theme-toggle" onclick="toggleTheme()">üåì</button>
                <button class="close-sidebar-btn" onclick="toggleSidebar()">‚úï</button>
            </div>
        </div>
        <div id="novel-list">
            <div style="padding:20px; text-align:center; color:gray;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
        </div>
    </div>

    <div id="main">
        <div id="reader-content">
            <h1 style="border:none">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö</h1>
            <p>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ‚ò∞ ‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢</p>
        </div>
        <div class="nav-btns" id="nav-btns" style="display:none">
            <button onclick="prevChapter()">‚ùÆ ‡∏ï‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>
            <button onclick="nextChapter()">‡∏ï‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚ùØ</button>
        </div>
    </div>

    <script>
        let novelData = {};
        let currentNovelId = null;
        let currentChapterIndex = -1;
        let currentChapterList = [];

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î Sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            sidebar.classList.toggle('show');
            
            if (sidebar.classList.contains('show')) {
                overlay.style.display = 'block';
            } else {
                overlay.style.display = 'none';
            }
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        fetch('novels.json')
            .then(response => response.json())
            .then(data => {
                if (Array.isArray(data)) {
                    alert("‚ö†Ô∏è ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á JSON ‡πÄ‡∏Å‡πà‡∏≤ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏±‡∏ô‡∏ö‡∏≠‡∏ó‡πÉ‡∏´‡∏°‡πà"); return;
                }
                novelData = data;
                renderSidebar();
                
                // ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≠‡∏ô‡πÄ‡∏Å‡πà‡∏≤
                const lastNovel = localStorage.getItem('lastNovelId');
                const lastEp = localStorage.getItem('lastEpId');
                
                if (lastNovel && novelData[lastNovel]) {
                    const details = document.getElementById(`details-${btoa(lastNovel)}`);
                    if (details) details.open = true;
                    
                    const chapters = novelData[lastNovel].chapters.sort((a, b) => parseInt(a.ep_id) - parseInt(b.ep_id));
                    const idx = chapters.findIndex(c => c.ep_id == lastEp);
                    if (idx !== -1) loadChapter(lastNovel, idx, false); // false = ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á auto close ‡∏ï‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
                }
            })
            .catch(err => {
                console.error(err);
                document.getElementById('novel-list').innerHTML = `<p style="color:red; text-align:center">‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</p>`;
            });

        function renderSidebar() {
            const list = document.getElementById('novel-list');
            list.innerHTML = '';
            
            const keys = Object.keys(novelData);
            if (keys.length === 0) { list.innerHTML = '<p style="text-align:center">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢</p>'; return; }

            keys.forEach(novelId => {
                const novel = novelData[novelId];
                const details = document.createElement('details');
                details.id = `details-${btoa(novelId)}`;
                
                const summary = document.createElement('summary');
                summary.innerText = novel.title;
                
                const div = document.createElement('div');
                const sortedChapters = novel.chapters.sort((a, b) => parseInt(a.ep_id) - parseInt(b.ep_id));
                
                sortedChapters.forEach((ep, index) => {
                    const item = document.createElement('div');
                    item.className = 'chapter-item';
                    item.innerText = ep.title;
                    item.onclick = () => loadChapter(novelId, index, true); // true = ‡∏Å‡∏î‡πÄ‡∏≠‡∏á ‡πÉ‡∏´‡πâ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π
                    item.id = `ep-${ep.ep_id}`;
                    div.appendChild(item);
                });

                details.appendChild(summary);
                details.appendChild(div);
                list.appendChild(details);
            });
        }

        function loadChapter(novelId, index, autoCloseMenu = true) {
            currentNovelId = novelId;
            currentChapterList = novelData[novelId].chapters.sort((a, b) => parseInt(a.ep_id) - parseInt(b.ep_id));
            currentChapterIndex = index;
            const ep = currentChapterList[index];
            
            document.getElementById('reader-content').innerHTML = `
                <div style="font-size:14px; color:gray; margin-bottom:10px;">üìñ ${novelData[novelId].title}</div>
                <h1>${ep.title}</h1>
                <div class="content-body">${ep.content}</div>
                <hr>
                <div style="font-size: 14px; color: gray;">Original: <a href="${ep.link}" target="_blank">Link</a></div>
            `;
            document.getElementById('nav-btns').style.display = 'flex';
            
            // Highlight Active
            document.querySelectorAll('.chapter-item').forEach(el => el.classList.remove('active'));
            const activeItem = document.getElementById(`ep-${ep.ep_id}`);
            if(activeItem) activeItem.classList.add('active');

            // Scroll Top
            document.getElementById('main').scrollTop = 0;
            window.scrollTo(0, 0); // ‡πÄ‡∏ú‡∏∑‡πà‡∏≠ Mobile browser
            
            localStorage.setItem('lastNovelId', novelId);
            localStorage.setItem('lastEpId', ep.ep_id);

            // ‚úÖ ‡∏ñ‡πâ‡∏≤‡∏î‡∏π‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ ‡πÉ‡∏´‡πâ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≠‡∏ô
            if (autoCloseMenu && window.innerWidth <= 768) {
                toggleSidebar();
            }
        }

        function nextChapter() {
            if (currentChapterIndex < currentChapterList.length - 1) {
                loadChapter(currentNovelId, currentChapterIndex + 1, false); // ‡∏Å‡∏î‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏°‡∏±‡∏ô‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
            }
        }

        function prevChapter() {
            if (currentChapterIndex > 0) {
                loadChapter(currentNovelId, currentChapterIndex - 1, false);
            }
        }

        function toggleTheme() {
            const body = document.body;
            const isDark = body.getAttribute('data-theme') === 'dark';
            body.setAttribute('data-theme', isDark ? 'light' : 'dark');
        }
    </script>
</body>
</html>
