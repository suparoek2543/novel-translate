<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Novel Reader</title>
    <style>
        :root {
            --bg-color: #f4f4f9;
            --text-color: #333;
            --sidebar-bg: #fff;
            --accent-color: #6c5ce7;
            --hover-color: #f0f0f0;
        }
        [data-theme="dark"] {
            --bg-color: #1e1e1e;
            --text-color: #e0e0e0;
            --sidebar-bg: #2d2d2d;
            --accent-color: #a29bfe;
            --hover-color: #3d3d3d;
        }
        body { margin: 0; font-family: 'Sarabun', sans-serif; background: var(--bg-color); color: var(--text-color); display: flex; height: 100vh; overflow: hidden; transition: 0.3s; }
        
        /* Sidebar */
        #sidebar { width: 320px; background: var(--sidebar-bg); border-right: 1px solid #ccc; display: flex; flex-direction: column; }
        .sidebar-header { padding: 20px; font-weight: bold; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        #novel-list { flex: 1; overflow-y: auto; padding: 10px; margin: 0; }
        
        /* Novel Group (Accordion) */
        details { margin-bottom: 10px; border-radius: 5px; overflow: hidden; border: 1px solid transparent; }
        details[open] { border-color: #ddd; background: var(--bg-color); }
        summary { 
            cursor: pointer; padding: 10px; font-weight: bold; list-style: none; 
            display: flex; align-items: center; transition: 0.2s;
        }
        summary:hover { background: var(--hover-color); }
        summary::before { content: 'üìÅ'; margin-right: 8px; }
        details[open] summary::before { content: 'üìÇ'; }
        
        /* Chapter Item */
        .chapter-item { 
            padding: 8px 10px 8px 35px; cursor: pointer; font-size: 14px; 
            border-bottom: 1px solid rgba(0,0,0,0.05); transition: 0.2s;
            display: flex; align-items: center;
        }
        .chapter-item::before { content: 'üìÑ'; margin-right: 8px; font-size: 12px; opacity: 0.7; }
        .chapter-item:hover { background: var(--hover-color); color: var(--accent-color); }
        .chapter-item.active { background: var(--accent-color); color: white; }
        
        /* Main Content */
        #main { flex: 1; padding: 40px; overflow-y: auto; max-width: 900px; margin: 0 auto; line-height: 1.8; font-size: 18px; }
        h1 { color: var(--accent-color); border-bottom: 2px solid var(--accent-color); padding-bottom: 10px; }
        .content-body { white-space: pre-wrap; margin-bottom: 50px; }
        .nav-btns { display: flex; justify-content: space-between; margin-top: 30px; }
        button { padding: 10px 20px; border: none; background: var(--accent-color); color: white; cursor: pointer; border-radius: 5px; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .theme-toggle { cursor: pointer; background: none; border: 1px solid var(--text-color); color: var(--text-color); padding: 5px 10px; border-radius: 15px; font-size: 12px; }

        @media (max-width: 768px) {
            body { flex-direction: column; }
            #sidebar { width: 100%; height: 40%; }
            #main { height: 60%; padding: 20px; }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>

    <div id="sidebar">
        <div class="sidebar-header">
            üìö ‡∏Ñ‡∏•‡∏±‡∏á‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢
            <button class="theme-toggle" onclick="toggleTheme()">üåì Theme</button>
        </div>
        <div id="novel-list">
            </div>
    </div>

    <div id="main">
        <div id="reader-content">
            <h1 style="border:none">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö</h1>
            <p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡πà‡∏≤‡∏ô...</p>
        </div>
        <div class="nav-btns" id="nav-btns" style="display:none">
            <button onclick="prevChapter()">PREV</button>
            <button onclick="nextChapter()">NEXT</button>
        </div>
    </div>

    <script>
        let novelData = {}; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        let currentNovelId = null;
        let currentChapterIndex = -1;
        let currentChapterList = [];

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        fetch('novels.json')
            .then(response => response.json())
            .then(data => {
                novelData = data;
                renderSidebar();
                
                // ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≠‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ
                const lastNovel = localStorage.getItem('lastNovelId');
                const lastEp = localStorage.getItem('lastEpId');
                
                if (lastNovel && novelData[lastNovel]) {
                    // ‡πÄ‡∏õ‡∏¥‡∏î Accordion ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏±‡πâ‡∏ô
                    const details = document.getElementById(`details-${btoa(lastNovel)}`);
                    if (details) details.open = true;
                    
                    // ‡∏´‡∏≤ index ‡∏Ç‡∏≠‡∏á‡∏ï‡∏≠‡∏ô
                    const chapters = novelData[lastNovel].chapters.sort((a, b) => parseInt(a.ep_id) - parseInt(b.ep_id));
                    const idx = chapters.findIndex(c => c.ep_id == lastEp);
                    if (idx !== -1) loadChapter(lastNovel, idx);
                }
            })
            .catch(err => console.error("‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ", err));

        function renderSidebar() {
            const list = document.getElementById('novel-list');
            list.innerHTML = '';

            // ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏™‡∏£‡πâ‡∏≤‡∏á Folder ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á
            Object.keys(novelData).forEach(novelId => {
                const novel = novelData[novelId];
                
                const details = document.createElement('details');
                details.id = `details-${btoa(novelId)}`; // ‡∏™‡∏£‡πâ‡∏≤‡∏á ID ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
                
                const summary = document.createElement('summary');
                summary.innerText = novel.title;
                
                const ul = document.createElement('div');
                
                // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≠‡∏ô
                const sortedChapters = novel.chapters.sort((a, b) => parseInt(a.ep_id) - parseInt(b.ep_id));
                
                sortedChapters.forEach((ep, index) => {
                    const item = document.createElement('div');
                    item.className = 'chapter-item';
                    item.innerText = ep.title; // ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≠‡∏ô
                    item.onclick = () => loadChapter(novelId, index);
                    item.id = `ep-${ep.ep_id}`;
                    ul.appendChild(item);
                });

                details.appendChild(summary);
                details.appendChild(ul);
                list.appendChild(details);
            });
        }

        function loadChapter(novelId, index) {
            currentNovelId = novelId;
            currentChapterList = novelData[novelId].chapters.sort((a, b) => parseInt(a.ep_id) - parseInt(b.ep_id));
            currentChapterIndex = index;
            
            const ep = currentChapterList[index];
            
            // Render ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤
            const contentDiv = document.getElementById('reader-content');
            contentDiv.innerHTML = `
                <div style="font-size:14px; color:gray; margin-bottom:10px;">üìñ ${novelData[novelId].title}</div>
                <h1>${ep.title}</h1>
                <div class="content-body">${ep.content}</div>
                <hr>
                <div style="font-size: 14px; color: gray;">‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö: <a href="${ep.link}" target="_blank">Link</a></div>
            `;

            document.getElementById('nav-btns').style.display = 'flex';
            
            // Highlight
            document.querySelectorAll('.chapter-item').forEach(el => el.classList.remove('active'));
            const activeItem = document.getElementById(`ep-${ep.ep_id}`);
            if(activeItem) activeItem.classList.add('active');

            // Scroll Top
            document.getElementById('main').scrollTop = 0;
            
            // Save state
            localStorage.setItem('lastNovelId', novelId);
            localStorage.setItem('lastEpId', ep.ep_id);
        }

        function nextChapter() {
            if (currentChapterIndex < currentChapterList.length - 1) {
                loadChapter(currentNovelId, currentChapterIndex + 1);
            }
        }

        function prevChapter() {
            if (currentChapterIndex > 0) {
                loadChapter(currentNovelId, currentChapterIndex - 1);
            }
        }

        function toggleTheme() {
            const body = document.body;
            const isDark = body.getAttribute('data-theme') === 'dark';
            body.setAttribute('data-theme', isDark ? 'light' : 'dark');
        }
    </script>
</body>
</html>
